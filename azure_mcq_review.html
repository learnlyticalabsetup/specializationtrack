<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure MCQ Review - Question Review Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0078d4, #106ebe, #005a9e);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: relative;
            margin-bottom: 30px;
        }

        h1 {
            color: #0078d4;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        select, input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #0078d4;
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        .search-bar {
            grid-column: 1 / -1;
        }

        .question-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .question-number {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .question-meta {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .difficulty-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .difficulty-foundation { background: #d4edda; color: #155724; }
        .difficulty-intermediate { background: #fff3cd; color: #856404; }
        .difficulty-advanced { background: #f8d7da; color: #721c24; }

        .topic-badge {
            background: #e3f2fd;
            color: #1565c0;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9em;
        }

        .question-text {
            font-size: 1.3em;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #333;
            font-weight: 500;
        }

        .options {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option:hover {
            background: #e3f2fd;
            border-color: #90caf9;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.selected {
            background: #fff3cd;
            border-color: #ffc107;
        }

        .option-label {
            font-weight: bold;
            color: #0078d4;
            margin-right: 10px;
        }

        .explanation {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #0078d4;
            margin-top: 25px;
        }

        .explanation h4 {
            color: #0078d4;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 30px 0;
        }

        .pagination button {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .pagination button:hover {
            background: linear-gradient(135deg, #106ebe, #005a9e);
            transform: translateY(-2px);
        }

        .pagination button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .pagination span {
            margin: 0 15px;
            font-weight: bold;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            border-radius: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #0078d4;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .comment-section {
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            border-left: 6px solid #0078d4;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .admin-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
            z-index: 1000;
        }

        .admin-panel:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .question-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .question-meta {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="./azure_index.html" class="back-btn">‚Üê Back to Azure Platform</a>
        <div class="container">
            <h1>üìù Azure MCQ Review</h1>
            <p class="subtitle">650 Comprehensive Azure Questions - Interactive Review Platform</p>
        </div>
    </div>

    <div class="container">
        <div class="stats" id="statsContainer">
            <div class="stat-card">
                <div class="stat-number" id="totalQuestions">650</div>
                <div class="stat-label">Total Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="filteredQuestions">650</div>
                <div class="stat-label">Filtered Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="currentQuestion">1</div>
                <div class="stat-label">Current Question</div>
            </div>
        </div>

        <div class="controls">
            <div class="filter-grid">
                <select id="difficultyFilter">
                    <option value="">All Difficulty Levels</option>
                    <option value="Foundation">Foundation</option>
                    <option value="Intermediate">Intermediate</option>
                    <option value="Advanced">Advanced</option>
                </select>
                
                <select id="topicFilter">
                    <option value="">All Azure Topics</option>
                    <option value="Identity & Governance">Identity & Governance</option>
                    <option value="Data Storage">Data Storage</option>
                    <option value="Business Continuity">Business Continuity</option>
                    <option value="Infrastructure Solutions">Infrastructure Solutions</option>
                    <option value="Identity & Access Management">Identity & Access Management</option>
                    <option value="Security Operations">Security Operations</option>
                    <option value="Platform Protection">Platform Protection</option>
                    <option value="Data & Application Security">Data & Application Security</option>
                    <option value="Well-Architected Framework">Well-Architected Framework</option>
                    <option value="Hands-On Labs & Projects">Hands-On Labs & Projects</option>
                    <option value="FinOps Principles">FinOps Principles</option>
                    <option value="FinOps Lifecycle">FinOps Lifecycle</option>
                    <option value="FinOps Tools & Technologies">FinOps Tools & Technologies</option>
                    <option value="DevOps Fundamentals">DevOps Fundamentals</option>
                    <option value="Kubernetes">Kubernetes</option>
                    <option value="Source Control Strategy">Source Control Strategy</option>
                    <option value="CI/CD Pipeline Design">CI/CD Pipeline Design</option>
                    <option value="Infrastructure as Code">Infrastructure as Code</option>
                    <option value="Configuration Management">Configuration Management</option>
                    <option value="Release Strategy & Deployment">Release Strategy & Deployment</option>
                    <option value="Monitoring & Feedback">Monitoring & Feedback</option>
                    <option value="Security & Compliance">Security & Compliance</option>
                    <option value="Azure AI Services">Azure AI Services</option>
                    <option value="Azure Cognitive Services">Azure Cognitive Services</option>
                    <option value="Azure ML Studio">Azure ML Studio</option>
                    <option value="OpenAI on Azure">OpenAI on Azure</option>
                    <option value="Responsible AI">Responsible AI</option>
                    <option value="AI Monitoring & Security">AI Monitoring & Security</option>
                    <option value="AI Integration">AI Integration</option>
                    <option value="Hands-On AI Labs">Hands-On AI Labs</option>
                </select>
                
                <input type="text" id="searchInput" placeholder="Search questions..." class="search-bar">
            </div>
        </div>

        <div id="questionContainer">
            <!-- Questions will be loaded here -->
        </div>

        <div class="pagination">
            <button onclick="previousQuestion()">‚Üê Previous</button>
            <span id="pageInfo">Question 1 of 650</span>
            <button onclick="nextQuestion()">Next ‚Üí</button>
        </div>
    </div>

    <!-- Admin Panel Button -->
    <button class="admin-panel" id="adminPanelBtn" onclick="toggleAdminPanel()" style="display: none;">
        üë§ Admin Panel
    </button>

    <!-- Admin Modal -->
    <div class="admin-modal" id="adminModal">
        <div class="modal-content">
            <h2 style="color: #0078d4; margin-bottom: 30px;">üìä Azure Review Admin Panel</h2>
            <div style="display: grid; gap: 20px;">
                <button onclick="downloadCommentsCSV()" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    üìä Download Comments CSV
                </button>
                <button onclick="clearAllComments()" style="background: #dc3545; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    üóëÔ∏è Clear All Comments
                </button>
                <div id="commentsStats" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4>Comments Statistics</h4>
                    <p>Total Comments: <span id="totalComments">0</span></p>
                    <p>MCQ Comments: <span id="mcqComments">0</span></p>
                    <p>Assignment Comments: <span id="assignmentComments">0</span></p>
                    <p>Capstone Comments: <span id="capstoneComments">0</span></p>
                </div>
                <button onclick="toggleAdminPanel()" style="background: #6c757d; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    Close Panel
                </button>
            </div>
        </div>
    </div>

    <script>
        let questions = [];
        let filteredQuestions = [];
        let currentQuestionIndex = 0;

        // Authentication check
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuthentication()) {
                document.body.style.display = 'none';
                window.location.href = './azure_index.html';
            } else {
                const userRole = sessionStorage.getItem('azure_user_role');
                if (userRole === 'admin') {
                    document.getElementById('adminPanelBtn').style.display = 'block';
                    updateCommentsStats();
                }
                loadQuestions();
                addCommentSectionToQuestions();
            }
        });

        function checkAuthentication() {
            const authenticated = sessionStorage.getItem('azure_authenticated');
            const loginTime = sessionStorage.getItem('azure_login_time');
            
            if (!authenticated || !loginTime) {
                return false;
            }
            
            const currentTime = new Date().getTime();
            const sessionDuration = 24 * 60 * 60 * 1000; // 24 hours
            
            if (currentTime - parseInt(loginTime) > sessionDuration) {
                sessionStorage.clear();
                return false;
            }
            
            return true;
        }

        async function loadQuestions() {
            try {
                const response = await fetch('./azure_mcq_questions.csv');
                const csvData = await response.text();
                questions = parseCSV(csvData);
                filteredQuestions = [...questions];
                updateStats();
                displayQuestion();
                setupFilters();
            } catch (error) {
                console.error('Error loading questions:', error);
                alert('Error loading questions. Please check if the CSV file exists.');
            }
        }

        function parseCSV(csvData) {
            const lines = csvData.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',');
            const questions = [];

            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length >= 8) {
                    questions.push({
                        question: values[0],
                        options: [values[1], values[2], values[3], values[4]],
                        correct: values[5],
                        difficulty: values[6],
                        topic: values[7],
                        explanation: values[8] || 'Explanation not provided.'
                    });
                }
            }
            return questions;
        }

        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current.trim());
            return values;
        }

        function displayQuestion() {
            if (filteredQuestions.length === 0) {
                document.getElementById('questionContainer').innerHTML = 
                    '<div class="question-container"><h2>No questions match your filters.</h2></div>';
                return;
            }

            const question = filteredQuestions[currentQuestionIndex];
            const questionNumber = currentQuestionIndex + 1;
            const correctIndex = ['A', 'B', 'C', 'D'].indexOf(question.correct);

            const questionHTML = `
                <div class="question-container">
                    <div class="question-header">
                        <div class="question-number">Question ${questionNumber}</div>
                        <div class="question-meta">
                            <span class="difficulty-badge difficulty-${question.difficulty.toLowerCase()}">${question.difficulty}</span>
                            <span class="topic-badge">${question.topic}</span>
                        </div>
                    </div>
                    
                    <div class="question-text">${question.question}</div>
                    
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option ${index === correctIndex ? 'correct' : ''}" onclick="selectOption(${index})">
                                <span class="option-label">${String.fromCharCode(65 + index)}.</span>
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="explanation">
                        <h4>üí° Explanation:</h4>
                        <p>${question.explanation}</p>
                    </div>

                    <div class="comment-section">
                        <h4 style="color: #0078d4; margin-bottom: 20px; font-size: 1.4em;">üí¨ Question Review & Feedback</h4>
                        <textarea 
                            id="question-comment-${questionNumber}" 
                            placeholder="Share your feedback about this Azure question (clarity, difficulty, relevance, real-world applicability, etc.)"
                            style="width: 100%; padding: 20px; border: 2px solid #ddd; border-radius: 15px; resize: vertical; min-height: 120px; font-family: inherit; margin-bottom: 20px; font-size: 16px;"
                        ></textarea>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <select id="question-rating-${questionNumber}" style="padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px;">
                                <option value="">Overall Rating</option>
                                <option value="outstanding">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Outstanding</option>
                                <option value="excellent">‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
                                <option value="good">‚≠ê‚≠ê‚≠ê Good</option>
                                <option value="fair">‚≠ê‚≠ê Fair</option>
                                <option value="poor">‚≠ê Poor</option>
                            </select>
                            <select id="question-difficulty-${questionNumber}" style="padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px;">
                                <option value="">Difficulty Assessment</option>
                                <option value="appropriate">Perfect Difficulty</option>
                                <option value="too-easy">Too Easy</option>
                                <option value="too-hard">Too Hard</option>
                                <option value="unclear">Unclear/Confusing</option>
                            </select>
                            <select id="question-relevance-${questionNumber}" style="padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px;">
                                <option value="">Relevance to Azure</option>
                                <option value="highly-relevant">Highly Relevant</option>
                                <option value="relevant">Relevant</option>
                                <option value="somewhat-relevant">Somewhat Relevant</option>
                                <option value="not-relevant">Not Relevant</option>
                            </select>
                        </div>
                        <div style="text-align: center;">
                            <button 
                                onclick="submitQuestionComment(${questionNumber}, '${question.question.replace(/'/g, "\\'").substring(0, 50)}...')"
                                style="background: linear-gradient(135deg, #0078d4, #106ebe); color: white; border: none; padding: 15px 30px; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: all 0.3s ease; box-shadow: 0 4px 16px rgba(0, 120, 212, 0.3);">
                                Submit Question Feedback
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('questionContainer').innerHTML = questionHTML;
            updateStats();
        }

        function submitQuestionComment(questionNumber, questionTitle) {
            const commentText = document.getElementById(`question-comment-${questionNumber}`).value.trim();
            const rating = document.getElementById(`question-rating-${questionNumber}`).value;
            const difficulty = document.getElementById(`question-difficulty-${questionNumber}`).value;
            const relevance = document.getElementById(`question-relevance-${questionNumber}`).value;
            const username = sessionStorage.getItem('azure_username');
            
            if (!commentText) {
                alert('Please enter your feedback before submitting.');
                return;
            }
            
            const comment = {
                timestamp: new Date().toISOString(),
                user: username,
                type: 'mcq',
                itemId: questionNumber,
                category: 'Azure MCQ Questions',
                topic: filteredQuestions[currentQuestionIndex].topic,
                title: questionTitle,
                comment: commentText,
                rating: rating,
                difficulty: difficulty,
                relevance: relevance,
                id: Date.now() + Math.random()
            };
            
            saveComment(comment);
            
            // Clear form
            document.getElementById(`question-comment-${questionNumber}`).value = '';
            document.getElementById(`question-rating-${questionNumber}`).value = '';
            document.getElementById(`question-difficulty-${questionNumber}`).value = '';
            document.getElementById(`question-relevance-${questionNumber}`).value = '';
            
            showSuccessMessage('Question feedback submitted successfully!');
        }

        function saveComment(comment) {
            const existingComments = JSON.parse(localStorage.getItem('azure_review_comments') || '[]');
            existingComments.push(comment);
            localStorage.setItem('azure_review_comments', JSON.stringify(existingComments));
            updateCommentsStats();
        }

        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 20px 30px;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                z-index: 1000;
                font-size: 16px;
                font-weight: bold;
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 4000);
        }

        function selectOption(index) {
            const options = document.querySelectorAll('.option');
            options.forEach((option, i) => {
                option.classList.toggle('selected', i === index);
            });
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        function updateStats() {
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('filteredQuestions').textContent = filteredQuestions.length;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('pageInfo').textContent = 
                `Question ${currentQuestionIndex + 1} of ${filteredQuestions.length}`;

            // Update pagination buttons
            const prevBtn = document.querySelector('.pagination button:first-child');
            const nextBtn = document.querySelector('.pagination button:last-child');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === filteredQuestions.length - 1;
        }

        function setupFilters() {
            const difficultyFilter = document.getElementById('difficultyFilter');
            const topicFilter = document.getElementById('topicFilter');
            const searchInput = document.getElementById('searchInput');

            [difficultyFilter, topicFilter, searchInput].forEach(element => {
                element.addEventListener('change', applyFilters);
                if (element.type === 'text') {
                    element.addEventListener('input', applyFilters);
                }
            });
        }

        function applyFilters() {
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            const topicFilter = document.getElementById('topicFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredQuestions = questions.filter(question => {
                const matchesDifficulty = !difficultyFilter || question.difficulty === difficultyFilter;
                const matchesTopic = !topicFilter || question.topic === topicFilter;
                const matchesSearch = !searchTerm || 
                    question.question.toLowerCase().includes(searchTerm) ||
                    question.options.some(option => option.toLowerCase().includes(searchTerm)) ||
                    question.explanation.toLowerCase().includes(searchTerm);

                return matchesDifficulty && matchesTopic && matchesSearch;
            });

            currentQuestionIndex = 0;
            displayQuestion();
        }

        // Admin Panel Functions
        function toggleAdminPanel() {
            const modal = document.getElementById('adminModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function updateCommentsStats() {
            const comments = JSON.parse(localStorage.getItem('azure_review_comments') || '[]');
            const mcqComments = comments.filter(c => c.type === 'mcq').length;
            const assignmentComments = comments.filter(c => c.type === 'assignment').length;
            const capstoneComments = comments.filter(c => c.type === 'capstone').length;

            document.getElementById('totalComments').textContent = comments.length;
            document.getElementById('mcqComments').textContent = mcqComments;
            document.getElementById('assignmentComments').textContent = assignmentComments;
            document.getElementById('capstoneComments').textContent = capstoneComments;
        }

        function downloadCommentsCSV() {
            const comments = JSON.parse(localStorage.getItem('azure_review_comments') || '[]');
            
            if (comments.length === 0) {
                alert('No comments available to download.');
                return;
            }

            const csvContent = [
                ['Timestamp', 'User', 'Type', 'Category', 'Topic', 'Question/Item', 'Title', 'Comment', 'Rating', 'Difficulty', 'Additional Info'].join(','),
                ...comments.map(comment => [
                    comment.timestamp,
                    comment.user,
                    comment.type,
                    comment.category,
                    comment.topic,
                    comment.itemId,
                    `"${comment.title}"`,
                    `"${comment.comment}"`,
                    comment.rating || '',
                    comment.difficulty || '',
                    comment.relevance || comment.complexity || comment.timeline || comment.businessRelevance || ''
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `azure_review_comments_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function clearAllComments() {
            if (confirm('Are you sure you want to delete all comments? This action cannot be undone.')) {
                localStorage.removeItem('azure_review_comments');
                updateCommentsStats();
                alert('All comments have been cleared.');
            }
        }

        function addCommentSectionToQuestions() {
            // This function is called after authentication to ensure comment sections are added
        }

        // Close admin modal when clicking outside
        document.getElementById('adminModal').addEventListener('click', function(e) {
            if (e.target === this) {
                toggleAdminPanel();
            }
        });
    </script>
</body>
</html>